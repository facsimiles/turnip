type: charm
bases:
  - build-on:
    - name: ubuntu
      channel: "18.04"
      architectures: [amd64]
    run-on:
    - name: ubuntu
      channel: "18.04"
      architectures: [amd64]
parts:
  charm-wheels:
    source: https://git.launchpad.net/~canonical-launchpad-branches/turnip/+git/dependencies
    source-commit: "030fe3e51edfe8e8c8b3590b52c4792b21631f01"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": charm-wheels/
    prime:
      - "-charm-wheels"
  interface-rabbitmq:
    source: https://github.com/openstack/charm-interface-rabbitmq
    source-commit: "571f4864c2f942d92991b3f413323a04c6f56d72"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/interface/rabbitmq/
    stage:
      - layers
    prime:
      - "-layers"
  interface-http:
    source: https://github.com/juju-solutions/interface-http
    source-commit: "4a232c6998a0c7deac0c2362e7a9a4f1c776603b"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*":  layers/interface/http/
    stage:
      - layers
    prime:
      - "-layers"
  interface-mount:
    source: https://github.com/juju-solutions/interface-mount
    source-commit: "d5a2526fec9c3e8581f18b56e84a86871583e080"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/interface/mount/
    stage:
      - layers
    prime:
      - "-layers"
  interface-nrpe-external-master:
    source: https://github.com/canonical-ols/nrpe-external-master-interface
    source-commit: "20b2b9fb80613997cb99b8096040cbba72a0ef0c"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/interface/nrpe-external-master/
    stage:
      - layers
    prime:
      - "-layers"
  layer-apt:
    source: https://git.launchpad.net/layer-apt
    source-commit: "cf78622e68fe1ca97eb8993c5adc2616f9e110b9"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/layer/apt/
    stage:
      - layers
    prime:
      - "-layers"
  layer-basic:
    source: https://github.com/juju-solutions/layer-basic
    source-commit: "baf582236a7b946da4cd140fd6532a2e0c2774d5"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/layer/basic/
    stage:
      - layers
    prime:
      - "-layers"
  layer-options:
    source: https://github.com/juju-solutions/layer-options
    source-commit: "fcdcea4e5de3e1556c24e6704607862d0ba00a56"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/layer/options/
    stage:
      - layers
    prime:
      - "-layers"
  layer-status:
    source: https://github.com/juju-solutions/layer-status
    source-commit: "02658f0f6b2d29316b79820b206cec532c0459c8"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      "*": layers/layer/status/
    stage:
      - layers
    prime:
      - "-layers"
  launchpad-layers:
    source: https://git.launchpad.net/launchpad-layers
    source-commit: "6fcdb345faecb9940ec2fe541e255c546c950ed0"
    source-submodules: []
    source-type: git
    plugin: dump
    organize:
      turnip-base: layers/layer/turnip-base
      turnip-storage: layers/layer/turnip-storage
    stage:
      - layers
    prime:
      - "-layers"
  turnip-celery:
    after:
      - charm-wheels
      - interface-rabbitmq
      - interface-http
      - interface-mount
      - interface-nrpe-external-master
      - layer-apt
      - layer-basic
      - layer-options
      - layer-status
      - launchpad-layers
    source: .
    plugin: reactive
    build-snaps: [charm]
    build-environment:
      - CHARM_LAYERS_DIR: $CRAFT_STAGE/layers/layer
      - CHARM_INTERFACES_DIR: $CRAFT_STAGE/layers/interface
      - PIP_NO_INDEX: "true"
      - PIP_FIND_LINKS: $CRAFT_STAGE/charm-wheels
    reactive-charm-build-arguments: [--binary-wheels-from-source]
